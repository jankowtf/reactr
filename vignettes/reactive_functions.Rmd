---
title: "Specification of reactive functions"
author: "Janko Thyson"
date: "Saturday, October 11, 2014"
output:
  html_document:
    self_contained: no
---

```{r, echo=FALSE, cache=FALSE}
require(knitr)
# knitr::opts_chunk$set(cache=FALSE)
require("reactr")
opts_chunk$set(cache=TRUE, cache.path = 'reactive_functions_cache/', fig.path='img/')
```

Currently, the main function in order to set reactive bindings that offer the most flexibility is `setReactiveS3()`.

You currently have three different options in order to specify the function that defines the actual relationship to referenced objects.

## Option 1: via markup in comments (recommended)

The easiest and most compact way of letting `setReactiveS3()` know which objects you are referencing is by specifying them in a special comment that is recognized as "markup":

```{r, eval=FALSE, cache=FALSE}
## [@object-ref: {id} in {where} as {ref-id}]
```

### Explanation

- `{id}`: name/ID that the referenced object has been assigned to
- `{where}` (optional): environment that the referenced object has been assigned to
- '{ref-id}' (optional): alternative name/ID that is used in the reactive function
- the leading `##` are optional in the sense that the entire line must simply be a valid comment in R scripts (e.g., could also be `#` or `###` etc.)

### Examples

Here are the possible markup constellations

```{r, eval=FALSE}
## [@object-ref: x_1]
## [@object-ref: x_1 in where_1]
## [@object-ref: x_1 in where_1 as ref_1]
## [@object-ref: x_1 as ref_1]
```

Actual examples

```{r, eval=TRUE}
setReactiveS3(id = "x_1", value = 10)

## With curly brackets //
setReactiveS3(id = "x_2", value = function() {
    ## [@object-ref: x_1]
    x_1 * 2
  }
)

## W/o curly brackets //
setReactiveS3(id = "x_3", value = function()
  ## [@object-ref: x_1]
  x_1 * 2
)

## With '{ref-id}' //
setReactiveS3(id = "x_4", value = function()
  ## [@object-ref: x_1 as ref_1]
  ref_1 * 2
)

## Multiple //
setReactiveS3(id = "x_5", value = function()
  ## [@object-ref: x_1 in where as ref_1]
  ## [@object-ref: x_2 as ref_2]
  ref_1 + ref_2
)
```

Note that the order matters!
This is a limitation that is hopefully relaxed in future releases

```{r, eval=TRUE}
try(
  setReactiveS3(id = "x_6", value = function()
    ## [@object-ref: x_1 as ref_1 in where]
    ## [@object-ref: x_2 as ref_2]
    ref_1 + ref_2
  )
)
```

Clean up 

```{r, eval=TRUE}
rm(x_1)
rm(x_2)
rm(x_3)
rm(x_4)
resetRegistry()

```

## Option 2: via argument `refs`

You can also specify the references by using the argument `refs`:

```{r, eval=FALSE}
refs = list({id} = {where}, {id} = {where})
```

Actual examples

```{r, eval=TRUE}
setReactiveS3(id = "x_1", value = 10)
where <- environment()

## With curly brackets //
setReactiveS3(id = "x_2", value = function(refs = list(x_1 = where)) {
  x_1 * 2
})
## W/o curly brackets //
setReactiveS3(id = "x_3", value = function(refs = list(x_1 = where))
  x_1 * 2
)
## Without explicit 'where' //
setReactiveS3(id = "x_4", value = function(refs = list(x_1 = NULL))
  x_1 * 2
)

## Clean up //
rm(x_1)
rm(x_2)
rm(x_3)
rm(x_4)
resetRegistry()
```

## Option 3: via explicit code 

You can also specify the references by using lines that start with 

```{r, eval=FALSE}
.ref_*
```

and request the referenced object via 

```{r, eval=FALSE}
get({id}, {where})
```

### Examples

```{r, eval=FALSE}
.ref_1 <- get(x = "x_1", envir = where_1)
.ref_2 <- get("x_1", where_1)
```

Actual examples

```{r, eval=TRUE}
setReactiveS3(id = "x_1", value = 10)

## With curly brackets //
setReactiveS3(id = "x_2", value = function() {
  .ref_1 <- get(x = "x_1", inherits = FALSE)
  .ref_1 * 2
})

## W/o curly brackets //
setReactiveS3(id = "x_3", value = function()
  .ref_1 <- get(x = "x_1", inherits = FALSE)
  ## For '* 2' you would need to use curly brackets 
  ## and a new line
)

## W/o argument names //
setReactiveS3(id = "x_4", value = function()
  .ref_1 <- get("x_1", inherits = FALSE)
  ## For '* 2' you would need to use curly brackets 
  ## and a new line
)

rm(x_1)
rm(x_2)
rm(x_3)
rm(x_4)
resetRegistry()
```
